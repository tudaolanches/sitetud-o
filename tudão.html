<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Tudão - Lanches & Porções</title>

    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        :root { --cor-primaria: #FFD700; --cor-secundaria: #D32F2F; --cor-texto: #1a1a1a; --cor-fundo-card: #ffffff; --cor-cinza: #f4f4f4; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Roboto', sans-serif; }
        body { background-color: var(--cor-primaria); color: var(--cor-texto); padding-bottom: 120px; }
        header { background-color: var(--cor-secundaria); color: white; padding: 15px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.2); position: sticky; top: 0; z-index: 100; }
        .logo-text { font-family: 'Fredoka One', cursive; font-size: 2rem; text-shadow: 2px 2px 0px #000; }
        .categorias { display: flex; overflow-x: auto; padding: 15px; gap: 10px; background: white; position: sticky; top: 65px; z-index: 90; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .cat-btn { background: var(--cor-cinza); border: none; padding: 10px 20px; border-radius: 20px; font-weight: bold; white-space: nowrap; cursor: pointer; }
        .cat-btn.ativo { background: var(--cor-secundaria); color: white; }
        .menu-container { max-width: 1000px; margin: 0 auto; padding: 20px; }
        .grid-produtos { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .produto-card { background: var(--cor-fundo-card); border-radius: 15px; padding: 15px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); display: flex; flex-direction: column; justify-content: space-between; gap: 10px; }
        .prod-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .prod-numero { background: var(--cor-secundaria); color: white; padding: 2px 8px; border-radius: 5px; font-weight: bold; font-size: 0.9rem; }
        .prod-nome { font-size: 1.2rem; font-weight: 800; }
        .prod-desc { font-size: 0.9rem; color: #555; margin-bottom: 10px; }
        .prod-footer { display: flex; justify-content: space-between; align-items: center; border-top: 1px dashed #ccc; padding-top: 10px; }
        .prod-preco { font-size: 1.2rem; font-weight: 900; color: var(--cor-secundaria); }
        .btn-add { background: #27ae60; color: white; border: none; padding: 8px 14px; border-radius: 25px; font-weight: bold; cursor: pointer; }

        .btn-edit { background: #1976d2; color: white; border: none; padding: 6px 10px; border-radius: 8px; margin-right: 6px; cursor: pointer; }
        .btn-remove { background: #d32f2f; color: white; border: none; padding: 6px 10px; border-radius: 8px; cursor: pointer; }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 400; justify-content: center; align-items: center; padding: 20px; }
        .modal-content { background: white; width: 100%; max-width: 720px; border-radius: 10px; padding: 18px; max-height: 90vh; overflow-y: auto; position: relative; box-shadow: 0 6px 18px rgba(0,0,0,0.3); }
        .close-modal { position: absolute; top: 12px; right: 12px; font-size: 1.3rem; cursor: pointer; color:#666; }

        #cart-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: white; padding: 12px 16px; z-index: 150; display: none; justify-content: space-between; align-items: center; box-shadow: 0 -2px 6px rgba(0,0,0,0.1); }

        #checkout-screen { display: none; background: white; min-height: 100vh; padding: 20px; max-width: 900px; margin: 0 auto; }

        .section-title { font-family: 'Fredoka One', cursive; color: var(--cor-secundaria); margin: 20px 0 10px 0; border-bottom: 2px solid #000; }
        .form-control { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 10px; }
        .small-muted { font-size:0.85rem; color:#555; }
        .troco-box { background:#fff6e5; padding:12px; border-radius:8px; margin-top:8px; border:1px solid #ffd57f; }

        .order-preview { white-space: pre-wrap; font-family: monospace; background:#fafafa; padding:12px; border-radius:6px; border:1px solid #eee; max-height:50vh; overflow:auto; }
        .confirm-actions { display:flex; gap:10px; margin-top:12px; justify-content:flex-end; }
        .btn-primary { background:var(--cor-secundaria); color:white; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; }
        .btn-secondary { background:#888; color:white; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; }

        /* small improvements for better mobile spacing */
        @media (max-width:600px){
            .modal-content{ padding:12px; }
            .prod-nome{ font-size:1rem; }
        }
    </style>
</head>
<body>

    <header>
        <div class="logo-text">TUDÃO</div>
        <div style="font-size: 0.8rem;">Fah e Pri Lanches</div>
    </header>

    <div id="main-screen">
        <div class="categorias" id="categorias-bar"></div>
        <div class="menu-container">
            <div id="menu-grid" class="grid-produtos"></div>
        </div>
    </div>

    <div id="cart-bar">
        <div class="cart-total" id="floating-total">R$ 0,00</div>
        <button class="btn-add" style="background:var(--cor-secundaria)" onclick="showCheckout()">FINALIZAR PEDIDO</button>
    </div>

    <!-- product modal (add/edit) -->
    <div class="modal" id="modal-produto">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <h3 id="modal-titulo"></h3>
            <p id="modal-desc"></p>

            <label style="font-weight:600; margin-top:8px;">Quantidade:</label>
            <input id="modal-qty" type="number" min="1" value="1" class="form-control" style="width:120px;">

            <div id="opcoes-adicionais" style="margin:15px 0;"></div>

            <div id="batata-adicional-note" class="small-muted hidden">
              Adicionais por tamanho conforme tabela: MINI / P / M / G / TUDÃO.
            </div>

            <textarea id="modal-obs" class="form-control" placeholder="Observações..."></textarea>
            <div style="display:flex; gap:8px; margin-top:8px;">
                <button class="btn-add" style="flex:1;" onclick="confirmAddToCart()">SALVAR ITEM</button>
                <button class="btn-secondary" style="flex:0 0 auto;" onclick="closeModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- confirmation modal shown before sending WhatsApp -->
    <div class="modal" id="confirm-modal" aria-hidden="true">
        <div class="modal-content">
            <span class="close-modal" onclick="closeConfirmModal()">&times;</span>
            <h3>Confirme seu pedido</h3>
            <p>Confira os itens abaixo e escolha uma ação:</p>
            <div id="order-preview" class="order-preview"></div>

            <div style="margin-top:10px;">
                <strong>Endereço / Entrega:</strong>
                <div id="confirm-endereco" style="margin-top:6px;" class="small-muted"></div>
            </div>

            <div style="margin-top:10px;">
                <strong>Pagamento:</strong>
                <div id="confirm-pagamento" style="margin-top:6px;" class="small-muted"></div>
            </div>

            <div style="margin-top:10px;">
                <strong>Total:</strong>
                <div id="confirm-total" style="margin-top:6px; font-size:1.1rem; font-weight:700;"></div>
            </div>

            <div class="confirm-actions">
                <button class="btn-secondary" onclick="editOrderFromConfirm()">Editar pedido</button>
                <button class="btn-primary" onclick="finalizeSendToWhatsApp()">Finalizar pedido (Enviar WhatsApp)</button>
            </div>
        </div>
    </div>

    <div id="checkout-screen">
        <button onclick="location.reload()" style="border:none; background:none; color:blue; cursor:pointer;"><i class="fas fa-arrow-left"></i> Voltar ao Menu</button>

        <h2 class="section-title">Finalizar Pedido</h2>
        <div id="cart-items-wrapper"></div>

        <h2 class="section-title">Entrega</h2>
        <select class="form-control" id="tipo-entrega" onchange="onFieldChange()">
            <option value="retirada">Retirar no Local</option>
            <option value="entrega">Entrega em Bauru</option>
        </select>

        <div id="delivery-info" class="hidden">
            <input type="text" id="endereco-input" class="form-control" placeholder="Rua e Número (Ex: Rua Batista de Carvalho, 123)">
            <input type="text" id="endereco-comp" class="form-control" placeholder="Bairro / Complemento" style="margin-top:10px;">
            <div class="small-muted" style="margin-top:8px; font-weight:600;">Taxa de entrega: a combinar</div>

            <div style="margin-top:10px;">
                <label><input type="checkbox" id="is-condominio" onchange="onCondominioChange(); onFieldChange()"> Condomínio / Apartamento </label>
                <div class="condo-note">Marque se o endereço for condomínio.</div>
            </div>

            <div id="condominio-info" class="hidden" style="margin-top:8px;">
                <input type="text" id="condominio-bloco" class="form-control" placeholder="Bloco (ex: A)">
                <input type="text" id="condominio-apto" class="form-control" placeholder="Apto (ex: 101)">
            </div>
        </div>

        <h2 class="section-title">Pagamento</h2>
        <input type="text" id="cliente-nome" class="form-control" placeholder="Seu Nome">

        <select class="form-control" id="forma-pagamento" onchange="onFieldChange()">
            <option value="Pix">Pix</option>
            <option value="Cartão">Cartão</option>
            <option value="Dinheiro">Dinheiro</option>
        </select>

        <div id="troco-section" class="hidden">
            <div style="margin-top:8px;">
                <label class="small-muted"><input type="checkbox" id="precisa-troco" onchange="onPrecisaTrocoChange(); onFieldChange()"> Preciso de troco</label>
            </div>
            <div id="troco-inputs" class="hidden" style="margin-top:10px;">
                <input type="text" id="valor-pagamento" class="form-control" placeholder="Valor que você dará (ex: 100,00)" inputmode="numeric" oninput="onValorPagamentoInput(this); onFieldChange()">
                <div id="troco-valor" class="troco-box" style="display:none;"></div>
            </div>
        </div>

        <div style="background:#eee; padding:20px; text-align:center; border-radius:10px; margin-top:20px;">
            <p>Total a Pagar:</p>
            <h1 id="checkout-total" style="color:var(--cor-secundaria)">R$ 0,00</h1>
            <p id="checkout-subtext" class="small-muted" style="margin-top:8px;"></p>
        </div>

        <button class="btn-add" style="width:100%; background:#25D366; padding:15px; margin-top:20px;" onclick="openConfirmModal()">
            <i class="fab fa-whatsapp"></i> ENVIAR PEDIDO VIA WHATSAPP
        </button>
    </div>

<script>
// ---------- Persistence keys ----------
const STORAGE_KEY = 'tudao_state_v1';

// ---------- Constants ----------
const batataSizeKeyById = {32:'mini',33:'p',34:'m',35:'g',36:'tudao',37:'m',38:'g'};
const batataExtrasPrices = {
  mini:{'Bacon':3.00,'Cheddar':2.00,'Catupiry':2.00,'Muçarela':3.00,'Pão com alho':5.00,'Batata Palha':2.00},
  p:{'Bacon':5.00,'Cheddar':4.00,'Catupiry':3.00,'Muçarela':5.00,'Pão com alho':5.00,'Batata Palha':2.00},
  m:{'Bacon':8.00,'Cheddar':5.00,'Catupiry':6.00,'Muçarela':8.00,'Pão com alho':5.00,'Batata Palha':2.00},
  g:{'Bacon':10.00,'Cheddar':6.00,'Catupiry':7.00,'Muçarela':10.00,'Pão com alho':5.00,'Batata Palha':2.00},
  tudao:{'Bacon':12.00,'Cheddar':8.00,'Catupiry':10.00,'Muçarela':12.00,'Pão com alho':5.00,'Batata Palha':2.00}
};
const lanchesExtras = {'Calabresa':4.50,'Alface':1.50,'Catupiry':4.00,'Hambúrguer':5.00,'Ovo':2.50,'Queijo':3.50,'Salsicha':3.50,'Vinagrete':3.50,'Bacon':5.00,'Batata Palha':2.00,'Cheddar':3.50,'Milho':2.50,'Presunto':3.50,'Salada Crua':3.50};

// ---------- Data (menu) ----------
const menuData = [
  { id:1,cat:'lanches',nome:'X-Tudão Especial',desc:'2 Hambúrgueres, 2 Salsichas, 2 Ovos, 2 Filés de Frango, Bacon, Batata, Queijo, Presunto, Catupiry, Vinagrete, Alface',preco:40.50},
  { id:2,cat:'lanches',nome:'X-Tudo',desc:'Hamburguer, Salsicha, Ovo, Filé de Frango, Bacon, Batata, Queijo, Presunto, Catupiry, Vinagrete, Maionese, Catchup e Alface.',preco:30.50},
  { id:3,cat:'lanches',nome:'X-Tudo Frango',desc:'Salsicha, Ovo, Filé de Frango, Bacon, Batata, Queijo, Presunto, Vinagrete, Maionese, Catchup e Alface.',preco:29.50},
  { id:4,cat:'lanches',nome:'X-Frango Salada',desc:'Filé de Frango, Batata, Queijo, Presunto, Vinagrete, Maionese, Catchup e Alface.',preco:24.50},
  { id:5,cat:'lanches',nome:'X-Frango Catupiry',desc:'Filé de Frango + Catupiry, Batata, Queijo, Presunto, Vinagrete, Maionese, Catchup e Alface.',preco:26.00},
  { id:6,cat:'lanches',nome:'X-Frango Bacon',desc:'Filé de Frango, Bacon, Batata, Queijo, Presunto, Vinagrete, Maionese, Catchup e Alface.',preco:26.50},
  { id:7,cat:'lanches',nome:'X-Egg Frango',desc:'Filé de Frango, Ovo, Batata, Queijo, Presunto, Vinagrete, Maionese, Catchup e Alface.',preco:25.50},
  { id:8,cat:'lanches',nome:'X-Egg Frango Bacon',desc:'Filé de Frango, Ovo, Bacon, Batata, Queijo, Presunto, Vinagrete, Maionese, Catchup e Alface.',preco:27.50},
  { id:9,cat:'lanches',nome:'Americano',desc:'Carne Bovina, Ovo, Batata, Queijo, Presunto, Tomate, Maionese e Alface.',preco:26.00},
  { id:10,cat:'lanches',nome:'X-Bacon Salada',desc:'Hamburguer, Bacon, Batata, Queijo, Presunto, Vinagrete, Maionese, Catchup e Alface.',preco:26.50},
  { id:11,cat:'lanches',nome:'X-Egg Bacon',desc:'Hamburguer, Bacon, Ovo, Batata, Queijo, Presunto, Vinagrete, Maionese, Catchup e Alface.',preco:27.00},
  { id:12,cat:'lanches',nome:'X-Salada Especial',desc:'Hamburguer, Batata, Queijo, Presunto, Vinagrete, Maionese, Catchup e Alface.',preco:22.50},
  { id:13,cat:'lanches',nome:'X-Egg Calabresa',desc:'Hamburguer, Ovo, Calabresa, Batata, Queijo, Presunto, Vinagrete, Maionese, Catchup e Alface.',preco:25.00},
  { id:14,cat:'lanches',nome:'X-Calabresa',desc:'Hamburguer, Calabresa, Batata, Queijo, Presunto, Vinagrete, Maionese, Catchup e Alface.',preco:24.50},
  { id:15,cat:'lanches',nome:'X-Burguer',desc:'Hamburguer, Batata, Queijo, Vinagrete, Maionese, Catchup e Alface.',preco:18.50},
  { id:16,cat:'lanches',nome:'Big Burguer Especial',desc:'2 Hamburgueres, Batata, Presunto, Queijo, Vinagrete, Maionese, Catchup e Alface.',preco:24.50},
  { id:17,cat:'lanches',nome:'Hamburguer Simples',desc:'Hamburguer, Batata, Vinagrete, Maionese, Catchup e Alface.',preco:17.50},
  { id:18,cat:'lanches',nome:'X-Cheddar',desc:'Hamburguer, Queijo, Cheddar, Batata, Tomate, Maionese, Catchup e Alface.',preco:21.50},
  { id:210,cat:'lanches',nome:'X-MISTÃO ESPECIAL',desc:'2 Hambúrgueres, Presunto, Queijo, Catchup',preco:28.50},
  { id:212,cat:'lanches',nome:'SUPER DOGÃO ESPECIAL',desc:'2 Salsichas, Presunto, Queijo, Bacon, Vinagrete, Batata, Alface, Maionese e Catchup',preco:27.00},
  { id:213,cat:'lanches',nome:'DOG SIMPLES',desc:'Salsicha, Queijo, Vinagrete, Batata, Alface, Maionese e Catchup',preco:18.50},
  { id:214,cat:'lanches',nome:'CACHORRO QUENTE SIMPLES',desc:'Salsichas, Vinagrete, Batata, Maionese e Catchup',preco:14.50},
  { id:215,cat:'lanches',nome:'MISTO SALADA',desc:'Presunto, Queijo, Tomate, Alface, Maionese e Catchup',preco:17.50},
  { id:216,cat:'lanches',nome:'MISTO QUENTE',desc:'Presunto, Queijo, Maionese e Catchup',preco:16.50},
  { id:217,cat:'lanches',nome:'X-EGG SALADA',desc:'Hambúrguer, Presunto, Queijo, Ovo, Vinagrete, Alface, Batata, Maionese e Catchup',preco:24.00},
  { id:218,cat:'lanches',nome:'X-CACHORRÃO QUENTE ESPECIAL',desc:'2 Salsichas, Vinagrete, Batata Palha, Alface, Milho, Catupiry, Presunto e Queijo, Catchup, Maionese e Mostarda',preco:21.50},
  { id:219,cat:'lanches',nome:'FOGUINHO',desc:'2 Salsichas, Ovo, Hambúrguer, Bacon, Catupiry, Frango, Presunto, Queijo e Batata Palha',preco:32.00},
  { id:220,cat:'lanches',nome:'X-JÃO',desc:'2 Salsichas, Hambúrguer, Presunto, Queijo, Batata Palha, Maionese e Catchup',preco:20.50},
  { id:221,cat:'lanches',nome:'X-BOSQUE (FRANGO)',desc:'2 Hambúrgueres, Presunto, Queijo, Cheddar, Bacon, Vinagrete, Batata Palha, Alface, Maionese e Catchup',preco:28.00},
  { id:222,cat:'lanches',nome:'X-FAH',desc:'Hambúrguer, Queijo, Ovo, Bacon, Alface, Tomate e Cebola Fatiada Crua, Maionese, Molho Alho, Mostarda e Catupiry',preco:28.00},
  { id:223,cat:'lanches',nome:'X-PLATINA',desc:'2 Hambúrgueres, Tomate, Queijo, Presunto, Catchup, Maionese, Alface, Batata Palha, Catupiry e Bacon',preco:28.00},

  { id:101,cat:'kids',nome:'X-Kids 1',desc:'Hamburgueres, Presunto, Queijo, Batata e Catchup.',preco:15.50},
  { id:102,cat:'kids',nome:'X-Kids 2',desc:'Filé de Frango, Queijo, Batata e Catchup.',preco:15.50},
  { id:103,cat:'kids',nome:'X-Kids 3',desc:'Salsicha, Presunto, Queijo, Batata e Catchup.',preco:14.00},

  { id:32,cat:'porcoes',nome:'Batata Palito Mini',desc:'Mini porção.',preco:10.00},
  { id:33,cat:'porcoes',nome:'Batata Palito Pequena',desc:'Porção pequena.',preco:25.00},
  { id:34,cat:'porcoes',nome:'Batata Palito Média',desc:'Porção média.',preco:30.00},
  { id:35,cat:'porcoes',nome:'Batata Palito Grande',desc:'Porção grande.',preco:40.00},
  { id:36,cat:'porcoes',nome:'Bata Tudão',desc:'Batata Tudão (grande especial).',preco:63.00},

  { id:40,cat:'pastéis',nome:'Pastel Carne (01)',desc:'Recheio de carne.',preco:16.00},
  { id:41,cat:'pastéis',nome:'Pastel Carne c/ Queijo (02)',desc:'Carne com queijo.',preco:18.00},
  { id:42,cat:'pastéis',nome:'Pastel Carne c/ Milho (03)',desc:'Carne com milho.',preco:17.00},
  { id:43,cat:'pastéis',nome:'Pastel Carne c/ Catupiry (04)',desc:'Carne com catupiry.',preco:18.00},
  { id:44,cat:'pastéis',nome:'Pastel Carne c/ Ovo (05)',desc:'Carne com ovo.',preco:17.00},
  { id:45,cat:'pastéis',nome:'Pastel Carne c/ Azeitonas (06)',desc:'Carne com azeitonas.',preco:17.00},
  { id:46,cat:'pastéis',nome:'Pastel Carne Especial (07)',desc:'Recheio especial da casa.',preco:18.00},
  { id:47,cat:'pastéis',nome:'Pastel Presunto e Queijo (08)',desc:'Presunto e queijo.',preco:16.00},
  { id:48,cat:'pastéis',nome:'Pastel Pizza (09)',desc:'Sabor pizza.',preco:16.00},
  { id:49,cat:'pastéis',nome:'Pastel Queijo (10)',desc:'Somente queijo.',preco:15.00},
  { id:50,cat:'pastéis',nome:'Pastel Queijo c/ Bacon (11)',desc:'Queijo com bacon.',preco:18.00},
  { id:51,cat:'pastéis',nome:'Pastel Queijo c/ Milho (12)',desc:'Queijo com milho.',preco:15.00},
  { id:52,cat:'pastéis',nome:'Pastel Queijo c/ Catupiry (13)',desc:'Queijo com catupiry.',preco:18.00},
  { id:53,cat:'pastéis',nome:'Pastel Frango (14)',desc:'Recheio de frango.',preco:15.00},
  { id:54,cat:'pastéis',nome:'Pastel Frango c/ Bacon (15)',desc:'Frango com bacon.',preco:18.00},
  { id:55,cat:'pastéis',nome:'Pastel Frango c/ Catupiry (16)',desc:'Frango com catupiry.',preco:18.00},
  { id:56,cat:'pastéis',nome:'Pastel Frango c/ Cheddar (17)',desc:'Frango com cheddar.',preco:18.00},
  { id:57,cat:'pastéis',nome:'Pastel Frango c/ Milho (18)',desc:'Frango com milho.',preco:17.00},
  { id:58,cat:'pastéis',nome:'Pastel Frango Muçarela e Milho (19)',desc:'Frango com muçarela e milho.',preco:19.00},
  { id:59,cat:'pastéis',nome:'Pastel Frango Especial (20)',desc:'Recheio especial de frango.',preco:20.00},
  { id:60,cat:'pastéis',nome:'Pastel Calabresa (21)',desc:'Calabresa acebolada.',preco:16.00},
  { id:61,cat:'pastéis',nome:'Pastel Calabresa c/ Queijo (22)',desc:'Calabresa com queijo.',preco:18.00},
  { id:62,cat:'pastéis',nome:'Pastel Tudão (23)',desc:'Pastel especial Tudão.',preco:25.00},
  { id:63,cat:'pastéis',nome:'Pastel Palmito c/ Queijo (24)',desc:'Palmito com queijo.',preco:19.00},
  { id:64,cat:'pastéis',nome:'Pastel Palmito c/ Catupiry (25)',desc:'Palmito com catupiry.',preco:21.00},
  { id:65,cat:'pastéis',nome:'Pastel Brócolis, Queijo e Bacon (26)',desc:'Brócolis com queijo e bacon.',preco:20.00},
  { id:66,cat:'pastéis',nome:'Pastel Portuguesa (28)',desc:'Presunto, Ovo, Tomate, Orégano.',preco:22.00},
  { id:67,cat:'pastéis',nome:'Pastel Carne Seca c/ Queijo (29)',desc:'Carne seca com queijo.',preco:20.00},
  { id:68,cat:'pastéis',nome:'Pastel Carne Seca c/ Catupiry e Bacon (30)',desc:'Carne seca com catupiry e bacon.',preco:23.00},

  { id:69,cat:'pastéis',nome:'Pastel Chocolate ao Leite',desc:'Doce.',preco:15.00},
  { id:70,cat:'pastéis',nome:'Pastel Nutella',desc:'Nutella.',preco:19.00},
  { id:71,cat:'pastéis',nome:'Pastel Nutella c/ Morango',desc:'Nutella com morango.',preco:20.50},
  { id:72,cat:'pastéis',nome:'Pastel Prestígio',desc:'Prestígio.',preco:9.00},
  { id:73,cat:'pastéis',nome:'Pastel Brigadeiro',desc:'Brigadeiro.',preco:5.00},
  { id:74,cat:'pastéis',nome:'Pastel Sonho de Valsa',desc:'Sonho de Valsa.',preco:5.00},
  { id:75,cat:'pastéis',nome:'Pastel Romeu e Julieta',desc:'Romeu e Julieta.',preco:12.00},
  { id:76,cat:'pastéis',nome:'Pastel Pé na Cova',desc:'Pé na Cova.',preco:7.00},

  { id:77,cat:'bebidas',nome:'Refrigerante Lata',desc:'350ml',preco:6.00},
  { id:230,cat:'bebidas',nome:'Refrigerante 2L',desc:'Garrafa 2 Litros',preco:14.00},
  { id:78,cat:'bebidas',nome:'Coca-Cola 1L',desc:'Garrafa 1 Litro',preco:10.50},
  { id:79,cat:'bebidas',nome:'Coca-Cola 2L',desc:'Garrafa 2 Litros',preco:15.00},
  { id:80,cat:'bebidas',nome:'Cerveja Lata',desc:'Lata',preco:6.00},
  { id:81,cat:'bebidas',nome:'Água',desc:'Sem gás',preco:4.00},
  { id:82,cat:'bebidas',nome:'Suco Laranja 500ml',desc:'Natural',preco:11.00},
  { id:83,cat:'bebidas',nome:'Suco Laranja 1L',desc:'Natural',preco:18.00},
  { id:84,cat:'bebidas',nome:'Suco Abacaxi 500ml',desc:'Natural',preco:11.00},
  { id:85,cat:'bebidas',nome:'Suco Abacaxi 1L',desc:'Natural',preco:18.00},
  { id:86,cat:'bebidas',nome:'Suco Maracujá c/ Água 500ml',desc:'Natural',preco:13.00},
  { id:87,cat:'bebidas',nome:'Suco Maracujá c/ Água 1L',desc:'Natural',preco:19.00},
  { id:88,cat:'bebidas',nome:'Suco Morango c/ Leite 500ml',desc:'Natural com Leite',preco:14.00},
  { id:89,cat:'bebidas',nome:'Suco Morango c/ Leite 1L',desc:'Natural com Leite',preco:20.00},
  { id:90,cat:'bebidas',nome:'Limonada Suíça 500ml',desc:'Natural',preco:13.00},
  { id:91,cat:'bebidas',nome:'Limonada Suíça 1L',desc:'Natural',preco:18.00},

  { id:200,cat:'combos',nome:'Combo Opção 1',desc:'Dogão Especial + Refri Guaraná/Pepsi + Batata Mini.',preco:35.99},
  { id:201,cat:'combos',nome:'Combo Opção 2',desc:'X-Burguer + Refri Guaraná/Pepsi + Batata Mini.',preco:35.99},
  { id:202,cat:'combos',nome:'Combo Opção 3',desc:'X-Frango Salada + Refri Guaraná/Pepsi + Batata Mini.',preco:37.99}
];

// ---------- State ----------
let cart = [];
let currentItem = null;
let currentCartIndex = null;

// ---------- Helpers ----------
function roundToCents(v){return Math.round(v*100)/100;}
function parseBRLToNumber(brlStr){ if(!brlStr) return 0; const cleaned=String(brlStr).replace(/\./g,'').replace(',', '.').replace(/[^\d.]/g,''); const n=parseFloat(cleaned); return isNaN(n)?0:n; }

// ---------- Persistence ----------
function saveState(){
  const state = {
    cart, clienteNome: document.getElementById('cliente-nome')?.value || '',
    tipoEntrega: document.getElementById('tipo-entrega')?.value || 'retirada',
    formaPagamento: document.getElementById('forma-pagamento')?.value || 'Pix',
    endereco: document.getElementById('endereco-input')?.value || '',
    enderecoComp: document.getElementById('endereco-comp')?.value || '',
    isCondominio: document.getElementById('is-condominio')?.checked || false,
    condBloco: document.getElementById('condominio-bloco')?.value || '',
    condApto: document.getElementById('condominio-apto')?.value || '',
    precisaTroco: document.getElementById('precisa-troco')?.checked || false,
    valorPagamento: document.getElementById('valor-pagamento')?.value || ''
  };
  try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }catch(e){console.warn('localStorage save failed',e);}  
}

function loadState(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY); if(!raw) return;
    const s = JSON.parse(raw);
    if(Array.isArray(s.cart)) cart = s.cart;
    if(document.getElementById('cliente-nome')) document.getElementById('cliente-nome').value = s.clienteNome || '';
    if(document.getElementById('tipo-entrega')) document.getElementById('tipo-entrega').value = s.tipoEntrega || 'retirada';
    if(document.getElementById('forma-pagamento')) document.getElementById('forma-pagamento').value = s.formaPagamento || 'Pix';
    if(document.getElementById('endereco-input')) document.getElementById('endereco-input').value = s.endereco || '';
    if(document.getElementById('endereco-comp')) document.getElementById('endereco-comp').value = s.enderecoComp || '';
    if(document.getElementById('is-condominio')) document.getElementById('is-condominio').checked = !!s.isCondominio;
    if(document.getElementById('condominio-bloco')) document.getElementById('condominio-bloco').value = s.condBloco || '';
    if(document.getElementById('condominio-apto')) document.getElementById('condominio-apto').value = s.condApto || '';
    if(document.getElementById('precisa-troco')) document.getElementById('precisa-troco').checked = !!s.precisaTroco;
    if(document.getElementById('valor-pagamento')) document.getElementById('valor-pagamento').value = s.valorPagamento || '';
  }catch(e){console.warn('localStorage load failed',e);}  
}

function onFieldChange(){
  // called by onchange/oninput for checkout fields to persist state
  // also updates visible UI for delivery/troco
  const tipo=document.getElementById('tipo-entrega')?.value; if(tipo) document.getElementById('delivery-info').classList.toggle('hidden', tipo!=='entrega');
  const forma=document.getElementById('forma-pagamento')?.value; if(forma) document.getElementById('troco-section').classList.toggle('hidden', forma!=='Dinheiro');
  if(document.getElementById('precisa-troco')?.checked) document.getElementById('troco-inputs').classList.remove('hidden'); else document.getElementById('troco-inputs')?.classList.add('hidden');
  saveState();
  updateCartUI();
}

// attach input listeners after DOM available

// ---------- Categories UI ----------
const categoryButtons = [
  {key:'todos',label:'Cardápio Completo'},
  {key:'lanches',label:'Lanches'},
  {key:'kids',label:'Kids'},
  {key:'pastéis',label:'Pastéis'},
  {key:'porcoes',label:'Porções'},
  {key:'bebidas',label:'Bebidas'},
  {key:'combos',label:'Combos'}
];

function buildCategoryBar(){
  const bar=document.getElementById('categorias-bar'); bar.innerHTML='';
  categoryButtons.forEach((c,i)=>{const btn=document.createElement('button'); btn.className='cat-btn'+(i===0?' ativo':''); btn.innerText=c.label; btn.onclick=()=>filterMenu(c.key,btn); bar.appendChild(btn);});
}

function filterMenu(cat,btnEl){ document.querySelectorAll('#categorias-bar .cat-btn').forEach(b=>b.classList.remove('ativo')); btnEl.classList.add('ativo'); if(cat==='todos') renderMenu(menuData); else renderMenu(menuData.filter(it=>it.cat===cat)); }

// ---------- Render menu / modal ----------
function renderMenu(list){ const grid=document.getElementById('menu-grid'); if(!grid) return; grid.innerHTML = list.map(item=>`<div class="produto-card"><div><div class="prod-header"><span class="prod-numero">#${item.id}</span></div><div class="prod-nome">${item.nome}</div><p class="prod-desc">${item.desc}</p></div><div class="prod-footer"><div class="prod-preco">R$ ${item.preco.toFixed(2).replace('.',',')}</div><button class="btn-add" onclick="openModal(${item.id})">Adicionar</button></div></div>`).join(''); }

function openModal(id,cartIndex=null){ currentItem = menuData.find(i=>i.id===id); if(!currentItem) return; currentCartIndex = cartIndex; document.getElementById('modal-titulo').innerText=currentItem.nome; document.getElementById('modal-desc').innerText=currentItem.desc; const qtyEl=document.getElementById('modal-qty'); qtyEl.value=1; let preExtras=[]; let preObs=''; if(currentCartIndex!==null && cart[currentCartIndex]){ const saved=cart[currentCartIndex]; qtyEl.value=saved.qty||1; preExtras=Array.isArray(saved.extrasNomes)?saved.extrasNomes.slice():[]; preObs=saved.obs||''; } document.getElementById('modal-obs').value=preObs; const opcoesEl=document.getElementById('opcoes-adicionais'); opcoesEl.innerHTML=''; document.getElementById('batata-adicional-note').classList.add('hidden'); const sizeKey=batataSizeKeyById[id]; if(currentItem.cat==='porcoes' && sizeKey && batataExtrasPrices[sizeKey]){ const prices=batataExtrasPrices[sizeKey]; document.getElementById('batata-adicional-note').classList.remove('hidden'); Object.keys(prices).forEach(extraName=>{ const price=prices[extraName]; const checked=preExtras.includes(extraName)?'checked':''; const label=document.createElement('label'); label.style.display='block'; label.style.marginBottom='6px'; label.innerHTML=`<input type="checkbox" data-name="${extraName}" data-value="${price.toFixed(2)}" ${checked}> ${extraName} (+R$ ${price.toFixed(2).replace('.',',')})`; opcoesEl.appendChild(label); }); } else if(currentItem.cat==='lanches' || currentItem.cat==='pastéis'){ Object.keys(lanchesExtras).forEach(extraName=>{ const price=lanchesExtras[extraName]; const checked=preExtras.includes(extraName)?'checked':''; const label=document.createElement('label'); label.style.display='block'; label.style.marginBottom='6px'; label.innerHTML=`<input type="checkbox" data-name="${extraName}" data-value="${price.toFixed(2)}" ${checked}> ${extraName} (+R$ ${price.toFixed(2).replace('.',',')})`; opcoesEl.appendChild(label); }); } else { opcoesEl.innerHTML=`<div class="small-muted">Sem adicionais para este item.</div>`; }
  document.getElementById('modal-produto').style.display='flex'; }

function closeModal(){ document.getElementById('modal-produto').style.display='none'; currentCartIndex=null; }

function confirmAddToCart(){ let extrasTotal=0; let extrasNomes=[]; document.querySelectorAll('#opcoes-adicionais input[type="checkbox"]:checked').forEach(ck=>{ let v=ck.getAttribute('data-value')||ck.value; let parsed=parseFloat(String(v).replace(',','.')); if(isNaN(parsed)) parsed=0; extrasTotal+=parsed; extrasNomes.push(ck.getAttribute('data-name')); }); const qty=Math.max(1,parseInt(document.getElementById('modal-qty').value||'1',10)); const obs=document.getElementById('modal-obs').value||''; const finalPrice=roundToCents((currentItem.preco+extrasTotal)*qty); const itemObj={ id:currentItem.id, cat:currentItem.cat, nome:currentItem.nome, desc:currentItem.desc, preco:currentItem.preco, qty, extrasTotal:roundToCents(extrasTotal), extrasNomes, obs, finalPrice }; if(currentCartIndex===null) cart.push(itemObj); else cart[currentCartIndex]=itemObj; saveState(); closeModal(); updateCartUI(); }

function removeFromCart(index){ if(!confirm('Remover este item do carrinho?')) return; cart.splice(index,1); saveState(); updateCartUI(); renderCartItems(); }
function editCartItem(index){ if(!cart[index]) return; const cartItem=cart[index]; openModal(cartItem.id,index); }

function updateCartUI(){ const sub=cart.reduce((sum,item)=>sum+item.finalPrice,0); const tipo=document.getElementById('tipo-entrega')?.value||'retirada'; let floatingText=`R$ ${sub.toFixed(2).replace('.',',')}`; if(tipo==='entrega') floatingText += ' + Taxa a combinar'; document.getElementById('floating-total').innerText=floatingText; document.getElementById('cart-bar').style.display=cart.length>0?'flex':'none'; calculateTotal(); renderCartItems(); saveState(); }

function renderCartItems(){ const wrapper=document.getElementById('cart-items-wrapper'); if(!wrapper) return; if(!cart||cart.length===0){ wrapper.innerHTML='<div style="padding:10px;">Nenhum item no carrinho.</div>'; return; } wrapper.innerHTML = cart.map((i,idx)=>`<div style="padding:10px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center;"><div style="flex:1;"><b>${i.nome} ${i.qty>1?'x'+i.qty:''}</b><br><small>R$ ${i.finalPrice.toFixed(2).replace('.',',')}</small>${i.extrasNomes&&i.extrasNomes.length?'<div style="margin-top:6px;"><small>Extras: '+i.extrasNomes.join(', ')+'</small></div>':''}${i.obs?'<div style="margin-top:6px;"><small>Obs: '+i.obs+'</small></div>':''}</div><div style="margin-left:10px; display:flex; flex-direction:column;"><button class="btn-edit" onclick="editCartItem(${idx})">Editar</button><button class="btn-remove" style="margin-top:6px;" onclick="removeFromCart(${idx})">Remover</button></div></div>`).join(''); }

function toggleDelivery(){ const tipo=document.getElementById('tipo-entrega').value; document.getElementById('delivery-info').classList.toggle('hidden', tipo!=='entrega'); onFieldChange(); }
function onCondominioChange(){ const checked=document.getElementById('is-condominio').checked; const info=document.getElementById('condominio-info'); if(checked) info.classList.remove('hidden'); else info.classList.add('hidden'); saveState(); }

function toggleTrocoUI(){ const forma=document.getElementById('forma-pagamento').value; document.getElementById('troco-section').classList.toggle('hidden', forma!=='Dinheiro'); }

function toggleTroco(){ toggleTrocoUI(); onFieldChange(); }

function onPrecisaTrocoChange(){ const checked=document.getElementById('precisa-troco').checked; const inputs=document.getElementById('troco-inputs'); if(checked) inputs.classList.remove('hidden'); else { inputs.classList.add('hidden'); document.getElementById('valor-pagamento').value=''; document.getElementById('troco-valor').style.display='none'; } saveState(); recalcTroco(); }

function onValorPagamentoInput(el){ const onlyDigits=el.value.replace(/\D/g,''); if(!onlyDigits){ el.value=''; recalcTroco(); return; } const asNumber=parseInt(onlyDigits,10); const cents=(asNumber/100).toFixed(2); const parts=cents.split('.'); let intPart=parts[0]; const decPart=parts[1]; intPart=intPart.replace(/\B(?=(\d{3})+(?!\d))/g,'.'); el.value=intPart+','+decPart; saveState(); recalcTroco(); }

function recalcTroco(){ const sub=cart.reduce((sum,i)=>sum+i.finalPrice,0); const total=roundToCents(sub); const precisa=document.getElementById('precisa-troco')?.checked; const display=document.getElementById('troco-valor'); const valPag=parseBRLToNumber(document.getElementById('valor-pagamento')?.value); if(precisa&&valPag>0){ const troco=roundToCents(valPag-total); display.style.display='block'; if(troco>=0) display.innerHTML=`<b>Troco a devolver:</b> R$ ${troco.toFixed(2).replace('.',',')}`; else display.innerHTML=`<b>Valor insuficiente:</b> faltam R$ ${Math.abs(troco).toFixed(2).replace('.',',')}`; } else { display.style.display='none'; } updateCheckoutSubtext(total); }

function updateCheckoutSubtext(total){ const subtextEl=document.getElementById('checkout-subtext'); const tipo=document.getElementById('tipo-entrega')?.value||'retirada'; const subtotal=cart.reduce((sum,i)=>sum+i.finalPrice,0); let parts=[`Subtotal: R$ ${subtotal.toFixed(2).replace('.',',')}`]; if(tipo==='entrega') parts.push(`Taxa: a combinar`); if(document.getElementById('is-condominio')?.checked) parts.push(`Condomínio: sim`); parts.push(`Total (sem taxa): R$ ${((typeof total!=='undefined')?total.toFixed(2).replace('.',','):subtotal.toFixed(2).replace('.',','))}`); subtextEl.innerText=parts.join(' | '); }

function calculateTotal(){ const sub=cart.reduce((sum,i)=>sum+i.finalPrice,0); const total=roundToCents(sub); document.getElementById('checkout-total').innerText=`R$ ${total.toFixed(2).replace('.',',')}`; updateCheckoutSubtext(total); recalcTroco(); }

function showCheckout(){ const main=document.getElementById('main-screen'); const cartBar=document.getElementById('cart-bar'); const checkout=document.getElementById('checkout-screen'); if(main) main.style.display='none'; if(cartBar) cartBar.style.display='none'; if(checkout) checkout.style.display='block'; renderCartItems(); calculateTotal(); }

// ---------- Confirm modal & WhatsApp ----------
function buildOrderMessage(){ const nome=document.getElementById('cliente-nome').value.trim(); const tipo=document.getElementById('tipo-entrega').value; const forma=document.getElementById('forma-pagamento').value; const sub=cart.reduce((sum,i)=>sum+i.finalPrice,0); const total=roundToCents(sub); let msg=`*PEDIDO TUDÃO*\n*Cliente:* ${nome}\n*Tipo:* ${tipo}\n*Pagamento:* ${forma}\n\n*ITENS:*`; cart.forEach(i=>{ const extras=i.extrasNomes&&i.extrasNomes.length?` - Extras: ${i.extrasNomes.join(', ')}`:''; const obs=i.obs?` [Obs: ${i.obs}]`:''; msg+=`\n- ${i.nome} ${i.qty>1?'x'+i.qty:''} - R$ ${i.finalPrice.toFixed(2).replace('.',',')}${extras}${obs}`; }); if(tipo==='entrega'){ const endereco=document.getElementById('endereco-input').value||''; const comp=document.getElementById('endereco-comp').value||''; msg+=`\n\n*Endereço:* ${endereco}`; if(document.getElementById('is-condominio')?.checked){ const bloco=document.getElementById('condominio-bloco').value||''; const apto=document.getElementById('condominio-apto').value||''; msg+=`\n*Condomínio/Apto:* Bloco: ${bloco} Apto: ${apto}`; } if(comp) msg+=`\n*Complemento/Bairro:* ${comp}`; msg+=`\n*Taxa:* a combinar`; } msg+=`\n*TOTAL (sem taxa):* R$ ${total.toFixed(2).replace('.',',')}`; if(forma==='Dinheiro'&&document.getElementById('precisa-troco')?.checked){ const valorPago=parseBRLToNumber(document.getElementById('valor-pagamento').value)||0; const troco=roundToCents(valorPago-total); msg+=`\n*Valor que dará:* R$ ${valorPago.toFixed(2).replace('.',',')}`; if(troco>=0) msg+=`\n*Troco a devolver:* R$ ${troco.toFixed(2).replace('.',',')}`; else msg+=`\n*Valor insuficiente:* faltam R$ ${Math.abs(troco).toFixed(2).replace('.',',')}`; } return msg; }

function buildOrderPreviewHtml(){ let lines=[]; cart.forEach(i=>{ const extras=i.extrasNomes&&i.extrasNomes.length?` Extras: ${i.extrasNomes.join(', ')}`:''; const obs=i.obs?` | Obs: ${i.obs}`:''; lines.push(`${i.nome} ${i.qty>1?'x'+i.qty:''} — R$ ${i.finalPrice.toFixed(2).replace('.',',')}${extras}${obs}`); }); return lines.join('\n'); }

function openConfirmModal(){ if(cart.length===0) return alert('Adicione itens ao carrinho antes de finalizar.'); const nome=document.getElementById('cliente-nome').value.trim(); if(!nome) return alert('Seu nome é obrigatório!'); const tipo=document.getElementById('tipo-entrega').value; if(tipo==='entrega'){ const endereco=document.getElementById('endereco-input').value.trim(); if(!endereco) return alert('Por favor, informe o endereço para entrega.'); } document.getElementById('order-preview').innerText=buildOrderPreviewHtml(); const tipoEntrega=document.getElementById('tipo-entrega').value; let enderecoText=tipoEntrega==='entrega'?(document.getElementById('endereco-input').value||''):'Retirar no local'; const comp=document.getElementById('endereco-comp').value||''; if(comp) enderecoText+=' | '+comp; if(document.getElementById('is-condominio')?.checked){ const bloco=document.getElementById('condominio-bloco').value||''; const apto=document.getElementById('condominio-apto').value||''; enderecoText+=`\nCondomínio: Bloco ${bloco} Apto ${apto}`; } document.getElementById('confirm-endereco').innerText=enderecoText; const forma=document.getElementById('forma-pagamento').value; let pagamentoText=forma; if(forma==='Dinheiro'&&document.getElementById('precisa-troco')?.checked) pagamentoText+=' — Precisa de troco'; document.getElementById('confirm-pagamento').innerText=pagamentoText; const sub=cart.reduce((sum,i)=>sum+i.finalPrice,0); document.getElementById('confirm-total').innerText=`R$ ${roundToCents(sub).toFixed(2).replace('.',',')} (taxa a combinar)`; document.getElementById('confirm-modal').style.display='flex'; document.getElementById('confirm-modal').setAttribute('aria-hidden','false'); }

function closeConfirmModal(){ const m=document.getElementById('confirm-modal'); m.style.display='none'; m.setAttribute('aria-hidden','true'); }
function editOrderFromConfirm(){ closeConfirmModal(); showCheckout(); }
function finalizeSendToWhatsApp(){ const msg=buildOrderMessage(); closeConfirmModal(); // open whatsapp
 window.open(`https://wa.me/5514991816332?text=${encodeURIComponent(msg)}`, '_blank'); }

// ---------- Save on relevant changes ----------
function registerFieldListeners(){ const ids=['cliente-nome','tipo-entrega','forma-pagamento','endereco-input','endereco-comp','is-condominio','condominio-bloco','condominio-apto','precisa-troco','valor-pagamento']; ids.forEach(id=>{ const el=document.getElementById(id); if(!el) return; const ev=(el.tagName==='INPUT' && el.type==='checkbox') ? 'change' : 'input'; el.addEventListener(ev, ()=>{ onFieldChange(); saveState(); }); });
}

// ---------- Init ----------
window.addEventListener('DOMContentLoaded', ()=>{
  buildCategoryBar(); renderMenu(menuData);
  loadState();
  // after load, ensure UI reflects loaded state
  if(document.getElementById('tipo-entrega')) document.getElementById('delivery-info').classList.toggle('hidden', document.getElementById('tipo-entrega').value!=='entrega');
  if(document.getElementById('forma-pagamento')) document.getElementById('troco-section').classList.toggle('hidden', document.getElementById('forma-pagamento').value!=='Dinheiro');
  if(document.getElementById('is-condominio')?.checked) document.getElementById('condominio-info').classList.remove('hidden');
  registerFieldListeners();
  updateCartUI();
});

</script>

</body>
</html>
